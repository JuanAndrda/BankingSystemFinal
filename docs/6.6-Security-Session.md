# Banking System - Security & Session Management Documentation

**Project:** Banking Management System Final Project
**Courses:** CIT 207 & CC 204
**Document:** Security & Session Management - Admin #21/#0/#20, Customer #6/#0/#7
**Date:** December 2025

---

## ğŸ“‘ Navigation

**â† Back to:** [Profile Operations & Reports](6.5-Profile-Reports.md) | **â†‘ Up to:** [Menu Overview](6-Menu-Overview.md)

**Menu Documentation Index:**
- [6-Menu-Overview.md](6-Menu-Overview.md) - Architecture and summary tables
- [6.1-Login.md](6.1-Login.md) - Login Screen
- [6.2-Customer-Ops.md](6.2-Customer-Ops.md) - Customer Operations (Admin #1-4)
- [6.3-Account-Ops.md](6.3-Account-Ops.md) - Account Operations (Admin #5-9)
- [6.4-Transaction-Ops.md](6.4-Transaction-Ops.md) - Transaction Operations (Admin #10-13, Customer #2-5)
- [6.5-Profile-Reports.md](6.5-Profile-Reports.md) - Profile & Reports (Admin #14-19)
- **6.6-Security-Session.md** - â† You are here

---

## Overview

This document covers **3 shared menu options** focused on security and session management. These operations are available to **both Admin and Customer users** and demonstrate:

- **Immutable User Pattern:** Password changes create new User objects
- **Session Management:** Login/logout tracking with `currentUser`
- **Graceful Exit:** System shutdown with confirmation
- **Audit Logging:** All security events logged to Stack
- **Polymorphism:** Admin and UserAccount handled uniformly

---

## Shared Option: Change Password

### 1. Menu Option Details

| Property | Value |
|----------|-------|
| **Admin Menu Number** | 21 |
| **Customer Menu Number** | 6 |
| **Menu Label** | "Change Password" |
| **MenuAction Enum** | `CHANGE_PASSWORD` |
| **Handler Method** | `BankingSystem.handleChangePassword()` |
| **Source File** | `src/com/banking/BankingSystem.java:515-563` |
| **Delegation** | `AuthenticationManager.changePassword()` (lines 175-253) |
| **Access Restrictions** | Both Admin and Customer (must be logged in) |
| **OOP Concept** | **Immutable User Pattern** (create new User instead of mutating) |

---

### 2. Purpose and Functionality

**What it does:**
- Allows logged-in users to change their password
- Validates current password before allowing change
- Creates **new User object** with new password (immutability)
- Replaces old User in registry (LinkedList replacement)
- Forces logout after password change (security best practice)
- Logs password change to audit trail

**Why it exists:**
- Security: Users can update compromised passwords
- Compliance: Password change capability required for banking systems
- First-time setup: Customers must change auto-generated temp passwords
- Demonstrates **Immutable User pattern** (User objects cannot be modified, only replaced)

**Business Rules:**
- Current password must be verified before change
- New password must be at least 4 characters
- New password must differ from current password
- Password change requires immediate logout (session invalidation)
- Both Admin and Customer can change passwords (shared operation)

---

### 3. Step-by-Step Code Flow

#### Step 1: Selection (User Input)
**Location:** `BankingSystem.java:515`

- **Admin:** Selects option **21** from Admin Menu
- **Customer:** Selects option **6** from Customer Menu

Both route to same handler: `handleChangePassword()`.

#### Step 2: Permission Check (Access Control)
**Location:** `BankingSystem.java:519-522`

```java
// Get current user
if (this.currentUser == null) {
    System.out.println("âœ— No user logged in");
    return;
}
```

**Access Control:**
- Requires active session (`currentUser != null`)
- No role-specific checks (both Admin and Customer allowed)

#### Step 3: Input Collection (Validation)
**Location:** `BankingSystem.java:524-556`

```java
String username = this.currentUser.getUsername();

while (true) {  // OUTER RETRY LOOP
    // Step 1: Prompt for current password
    String oldPassword = this.validator.getCancellableInput("Enter current password");
    if (oldPassword == null) {
        System.out.println("Password change cancelled.");
        return;
    }

    // INNER RETRY LOOP: Prompt for new password
    while (true) {
        String newPassword = this.validator.getCancellableInput("Enter new password (min 4 characters)");
        if (newPassword == null) {
            System.out.println("Password change cancelled.");
            return;
        }

        // Validate new password (min 4 chars)
        if (newPassword.length() < 4) {
            System.out.println("âœ— Password must be at least 4 characters. Please try again.");
            continue;  // Retry new password prompt
        }

        // Attempt password change
        User newUser = this.authManager.changePassword(username, oldPassword, newPassword);

        if (newUser != null) {
            // SUCCESS: Password changed
            System.out.println("âœ“ Password changed successfully!");
            System.out.println("âš  For security, you will be logged out. Please log in again with your new password.");

            // Update session with new User object
            this.currentUser = newUser;

            // Mark password as changed (for temp password requirement)
            this.currentUser.setPasswordChangeRequired(false);

            // FORCE LOGOUT (security best practice)
            this.authManager.logout();
            this.currentUser = null;

            return;  // Exit handler
        } else {
            // FAILURE: Old password incorrect or other error
            System.out.println("âš  Password change failed. Please try again.");
            break;  // Return to outer loop (re-enter current password)
        }
    }
}
```

**Validation Rules:**
- Current password must match (verified in `changePassword()`)
- New password minimum 4 characters
- New password must differ from current password
- User can cancel with "back"

#### Step 4: Business Logic (Immutable User Creation)
**Location:** `AuthenticationManager.java:175-253`

```java
public User changePassword(String username, String oldPassword, String newPassword) {
    // Step 1: Validate inputs
    if (username == null || oldPassword == null || newPassword == null) {
        System.out.println("âœ— Username and passwords cannot be null");
        return null;
    }

    // Step 2: Find the user in registry
    User currentUser = null;
    int userIndex = -1;
    for (int i = 0; i < this.userRegistry.size(); i++) {
        if (this.userRegistry.get(i).getUsername().equals(username)) {
            currentUser = this.userRegistry.get(i);
            userIndex = i;
            break;
        }
    }

    if (currentUser == null) {
        System.out.println("âœ— User not found: " + username);
        return null;
    }

    // Step 3: Verify old password matches
    if (!currentUser.authenticate(oldPassword)) {
        System.out.println("âœ— Current password is incorrect");
        return null;
    }

    // Step 4: Validate new password
    if (newPassword.isEmpty()) {
        System.out.println("âœ— New password cannot be empty");
        return null;
    }

    if (newPassword.length() < 4) {
        System.out.println("âœ— New password must be at least 4 characters");
        return null;
    }

    if (oldPassword.equals(newPassword)) {
        System.out.println("âœ— New password must be different from current password");
        return null;
    }

    // Step 5: Create new User object with new password (IMMUTABLE PATTERN)
    User newUser = null;
    try {
        if (currentUser instanceof Admin) {
            // Create new Admin with new password
            newUser = new Admin(username, newPassword);

        } else if (currentUser instanceof UserAccount) {
            // Create new UserAccount with new password, preserving linked customer ID
            UserAccount userAccount = (UserAccount) currentUser;
            newUser = new UserAccount(username, newPassword, userAccount.getLinkedCustomerId());

            // Preserve the passwordChangeRequired flag
            newUser.setPasswordChangeRequired(currentUser.isPasswordChangeRequired());

        } else {
            System.out.println("âœ— Unknown user type");
            return null;
        }
    } catch (Exception e) {
        System.out.println("âœ— Error creating new user object: " + e.getMessage());
        return null;
    }

    // Step 6: Replace old user with new user in registry (LinkedList replacement)
    try {
        this.userRegistry.set(userIndex, newUser);  // Replace at same index
    } catch (Exception e) {
        System.out.println("âœ— Error updating user registry: " + e.getMessage());
        return null;
    }

    // Step 7: Log the password change to audit trail
    logAction(username, currentUser.getUserRole(), "CHANGE_PASSWORD",
              "User successfully changed their password");

    return newUser;  // Return new User object for caller to use as currentUser
}
```

**Why Immutable User Pattern?**

```java
// WRONG APPROACH (if User was mutable):
currentUser.setPassword(newPassword);  // Direct mutation - BAD!

// CORRECT APPROACH (Immutable User):
User newUser = new Admin(username, newPassword);  // Create new object
userRegistry.set(index, newUser);                 // Replace in registry
this.currentUser = newUser;                        // Update session
```

**Benefits of Immutability:**
- **Thread-safe:** No concurrent modification issues
- **Audit-friendly:** Old User object still exists in memory until GC
- **Security:** Password changes are atomic (all-or-nothing)
- **Traceable:** Clear distinction between old and new User state

#### Step 5: Data Structure Updates
**Location:** `LinkedList<User> userRegistry` in AuthenticationManager

**Before Password Change:**
```
LinkedList<User> userRegistry:
  Index 0: Admin("admin", "admin123")              â† currentUser
  Index 1: UserAccount("alice", "alice123", "C001")
  Index 2: UserAccount("bob", "bob123", "C002")

currentUser = Admin@12345 {
    username: "admin",
    password: "admin123"  â† OLD PASSWORD
}
```

**After Password Change:**
```
LinkedList<User> userRegistry:
  Index 0: Admin("admin", "newPass456")            â† NEW OBJECT (replaced)
  Index 1: UserAccount("alice", "alice123", "C001")
  Index 2: UserAccount("bob", "bob123", "C002")

currentUser = null  â† LOGGED OUT (security)

Old Admin@12345 object eligible for garbage collection
New Admin@67890 object created and inserted at same index
```

**LinkedList Replacement:**
```java
userRegistry.set(userIndex, newUser);  // O(n) operation on LinkedList
```

Why not HashMap? User registry is small (< 50 users typically), sequential iteration is common (login checks all users), LinkedList is adequate.

#### Step 6: User Feedback (Console Output)
**Location:** `BankingSystem.java:548-556`

```
âœ“ Password changed successfully!
âš  For security, you will be logged out. Please log in again with your new password.
âœ“ admin logged out successfully.
```

Forces user to return to login screen.

#### Step 7: Audit Logging
**Location:** `AuthenticationManager.java:250`

```java
logAction(username, currentUser.getUserRole(), "CHANGE_PASSWORD",
          "User successfully changed their password");
```

Logged to `Stack<AuditLog>` for admin monitoring.

---

### 4. Code Snippets

#### Full Change Password Handler

**File:** `BankingSystem.java:515-563`

```java
/**
 * Handler: Change password for current user.
 * Customers must change their auto-generated password on first login.
 * Uses AuthenticationManager to create new User object (immutable pattern).
 */
private void handleChangePassword() {
    System.out.println("\n--- CHANGE PASSWORD ---");

    // Get current user
    if (this.currentUser == null) {
        System.out.println("âœ— No user logged in");
        return;
    }

    String username = this.currentUser.getUsername();

    while (true) {  // OUTER RETRY LOOP
        // Step 1: Prompt for current password
        String oldPassword = this.validator.getCancellableInput("Enter current password");
        if (oldPassword == null) {
            System.out.println("Password change cancelled.");
            return;
        }

        // INNER RETRY LOOP: Prompt for new password
        while (true) {
            String newPassword = this.validator.getCancellableInput("Enter new password (min 4 characters)");
            if (newPassword == null) {
                System.out.println("Password change cancelled.");
                return;
            }

            // Validate new password (min 4 chars)
            if (newPassword.length() < 4) {
                System.out.println("âœ— Password must be at least 4 characters. Please try again.");
                continue;  // Retry new password prompt
            }

            // Attempt password change (creates new User object)
            User newUser = this.authManager.changePassword(username, oldPassword, newPassword);

            if (newUser != null) {
                // SUCCESS
                System.out.println("âœ“ Password changed successfully!");
                System.out.println("âš  For security, you will be logged out. Please log in again with your new password.");

                // Update session with new User object
                this.currentUser = newUser;

                // Mark password as changed (for temp password requirement)
                this.currentUser.setPasswordChangeRequired(false);

                // FORCE LOGOUT (security best practice)
                this.authManager.logout();
                this.currentUser = null;

                return;  // Exit handler
            } else {
                // FAILURE: Old password incorrect or other error
                System.out.println("âš  Password change failed. Please try again.");
                break;  // Return to outer loop (re-enter current password)
            }
        }
    }
}
```

#### Immutable User Creation (Polymorphic)

**File:** `AuthenticationManager.java:220-239`

```java
// Step 5: Create new User object with new password (IMMUTABLE PATTERN)
User newUser = null;
try {
    // POLYMORPHISM: Runtime type check to create correct subclass
    if (currentUser instanceof Admin) {
        // Create new Admin with new password
        newUser = new Admin(username, newPassword);

    } else if (currentUser instanceof UserAccount) {
        // Create new UserAccount with new password, preserving linked customer ID
        UserAccount userAccount = (UserAccount) currentUser;
        newUser = new UserAccount(username, newPassword, userAccount.getLinkedCustomerId());

        // Preserve the passwordChangeRequired flag from the current user
        newUser.setPasswordChangeRequired(currentUser.isPasswordChangeRequired());

    } else {
        System.out.println("âœ— Unknown user type");
        return null;
    }
} catch (Exception e) {
    System.out.println("âœ— Error creating new user object: " + e.getMessage());
    return null;
}
```

**Key Points:**
- `instanceof` check determines runtime type (Admin vs UserAccount)
- New object created with **same username**, **new password**
- UserAccount preserves `linkedCustomerId` (critical - links to Customer)
- Old User object discarded (garbage collected)

---

### 5. Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CHANGE PASSWORD FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User selects option 21 (Admin) or 6 (Customer)
    â”‚
    â”œâ”€â”€â†’ Check: currentUser != null?
    â”‚         â”œâ”€â”€â†’ NO: Print error, return
    â”‚         â””â”€â”€â†’ YES: Continue
    â”‚
    â”œâ”€â”€â†’ Prompt: Enter current password
    â”‚         â””â”€â”€â†’ Validate cancellation ("back")
    â”‚
    â”œâ”€â”€â†’ Prompt: Enter new password (min 4 chars)
    â”‚         â”œâ”€â”€â†’ Validate length >= 4
    â”‚         â””â”€â”€â†’ Validate cancellation
    â”‚
    â”œâ”€â”€â†’ Call AuthenticationManager.changePassword()
    â”‚         â”‚
    â”‚         â”œâ”€â”€â†’ Find User in LinkedList<User> userRegistry
    â”‚         â”‚         â””â”€â”€â†’ Linear search by username
    â”‚         â”‚
    â”‚         â”œâ”€â”€â†’ Verify old password
    â”‚         â”‚         â””â”€â”€â†’ user.authenticate(oldPassword)
    â”‚         â”‚
    â”‚         â”œâ”€â”€â†’ Validate new password
    â”‚         â”‚         â”œâ”€ Length >= 4?
    â”‚         â”‚         â””â”€ Different from old password?
    â”‚         â”‚
    â”‚         â”œâ”€â”€â†’ Create New User Object (IMMUTABLE PATTERN)
    â”‚         â”‚         â”œâ”€ instanceof Admin? â†’ new Admin(username, newPassword)
    â”‚         â”‚         â””â”€ instanceof UserAccount? â†’ new UserAccount(username, newPassword, linkedCustomerId)
    â”‚         â”‚
    â”‚         â”œâ”€â”€â†’ Replace in registry
    â”‚         â”‚         â””â”€â”€â†’ userRegistry.set(index, newUser)
    â”‚         â”‚
    â”‚         â”œâ”€â”€â†’ Log to Audit Trail
    â”‚         â”‚         â””â”€â”€â†’ auditTrail.push(new AuditLog(...))
    â”‚         â”‚
    â”‚         â””â”€â”€â†’ Return newUser
    â”‚
    â”œâ”€â”€â†’ Update Session
    â”‚         â””â”€â”€â†’ this.currentUser = newUser
    â”‚
    â”œâ”€â”€â†’ Force Logout (Security)
    â”‚         â”œâ”€â”€â†’ authManager.logout()
    â”‚         â””â”€â”€â†’ currentUser = null
    â”‚
    â””â”€â”€â†’ Return to Login Screen
```

---

### 6. Example Usage

#### Scenario 1: Admin Changes Password (Success)

**Console Input/Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ BANKING MANAGEMENT SYSTEM          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[21] Change Password

--- CHANGE PASSWORD ---

â†’ Enter current password: admin123
â†’ Enter new password (min 4 characters): newSecurePass456

âœ“ Password changed successfully!
âš  For security, you will be logged out. Please log in again with your new password.
âœ“ admin logged out successfully.

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   BANKING SYSTEM - LOGIN REQUIRED   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â†’ Username: admin
â†’ Password: newSecurePass456
âœ“ Login successful! Welcome, admin
```

**Data Changes:**
```
BEFORE:
  userRegistry[0] = Admin("admin", "admin123")
  currentUser = Admin@12345

AFTER:
  userRegistry[0] = Admin("admin", "newSecurePass456")  â† NEW OBJECT
  currentUser = null  â† LOGGED OUT
```

**Audit Trail:**
```
Stack<AuditLog>:
  PUSH: [2025-12-04 16:45:00] admin (ADMIN) CHANGE_PASSWORD "User successfully changed their password"
  PUSH: [2025-12-04 16:45:05] admin (ADMIN) LOGOUT "User logged out"
  PUSH: [2025-12-04 16:46:10] admin (ADMIN) LOGIN_SUCCESS "User logged in successfully"
```

---

#### Scenario 2: Customer Changes Password (First-Time Temp Password)

**Console Input/Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ TRANSACTION MENU (ATM Mode)       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[6] Change Password

--- CHANGE PASSWORD ---

â†’ Enter current password: Welcomeal1234
â†’ Enter new password (min 4 characters): MyNewPassword

âœ“ Password changed successfully!
âš  For security, you will be logged out. Please log in again with your new password.
âœ“ alice logged out successfully.

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   BANKING SYSTEM - LOGIN REQUIRED   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â†’ Username: alice
â†’ Password: MyNewPassword
âœ“ Login successful! Welcome, alice
```

**Data Changes:**
```
BEFORE:
  userRegistry[1] = UserAccount("alice", "Welcomeal1234", "C001")
  passwordChangeRequired = true  â† TEMP PASSWORD

AFTER:
  userRegistry[1] = UserAccount("alice", "MyNewPassword", "C001")  â† NEW OBJECT
  passwordChangeRequired = false  â† PERMANENT PASSWORD
```

---

#### Scenario 3: Error - Incorrect Current Password

**Console Input/Output:**
```
--- CHANGE PASSWORD ---

â†’ Enter current password: wrongPass
â†’ Enter new password (min 4 characters): newPass123

âœ— Current password is incorrect
âš  Password change failed. Please try again.

â†’ Enter current password: admin123
â†’ Enter new password (min 4 characters): newPass123

âœ“ Password changed successfully!
...
```

---

#### Scenario 4: Error - New Password Too Short

**Console Input/Output:**
```
--- CHANGE PASSWORD ---

â†’ Enter current password: admin123
â†’ Enter new password (min 4 characters): abc

âœ— Password must be at least 4 characters. Please try again.

â†’ Enter new password (min 4 characters): abcd1234

âœ“ Password changed successfully!
...
```

---

#### Scenario 5: User Cancels Password Change

**Console Input/Output:**
```
--- CHANGE PASSWORD ---

â†’ Enter current password: back

Password change cancelled.

[Returns to menu]
```

---

## Shared Option: Logout

### 1. Menu Option Details

| Property | Value |
|----------|-------|
| **Admin Menu Number** | 0 |
| **Customer Menu Number** | 0 |
| **Menu Label** | "Logout" |
| **MenuAction Enum** | `LOGOUT` |
| **Handler Method** | `AuthenticationManager.logout()` |
| **Source File** | `src/com/banking/managers/AuthenticationManager.java:93-99` |
| **Access Restrictions** | Both Admin and Customer (must be logged in) |
| **OOP Concept** | **Session Management** (currentUser nullification) |

---

### 2. Purpose and Functionality

**What it does:**
- Logs out current user (clears session)
- Logs logout event to audit trail
- Returns to login screen
- Allows switching between user accounts

**Why it exists:**
- Security: Prevents unauthorized access after user leaves
- Multi-user support: Allows different users to log in
- Session management: Clean termination of user session
- Compliance: Logout capability required for banking systems

**Business Rules:**
- Only logged-in users can log out (no-op if already logged out)
- Logout is immediate (no confirmation required)
- Session is completely cleared (`currentUser = null`)
- Must log in again to access system

---

### 3. Step-by-Step Code Flow

#### Step 1-2: Selection & Permission
User selects option **0** from Admin or Customer menu.

#### Step 3-7: Business Logic (Session Clearing)
**Location:** `AuthenticationManager.java:93-99`

```java
public void logout() {
    if (currentUser != null) {
        System.out.println("âœ“ " + currentUser.getUsername() + " logged out successfully.");
        logAction(currentUser.getUsername(), currentUser.getUserRole(), "LOGOUT", "User logged out");
        currentUser = null;  // Clear session
    }
}
```

**Session State:**

**Before Logout:**
```java
currentUser = Admin("admin", "admin123", UserRole.ADMIN)
```

**After Logout:**
```java
currentUser = null  â† SESSION CLEARED
```

**Audit Log:**
```java
auditTrail.push(new AuditLog(
    LocalDateTime.now(),
    "admin",
    UserRole.ADMIN,
    "LOGOUT",
    "User logged out"
));
```

---

### 4. Code Snippets

#### Full Logout Method

**File:** `AuthenticationManager.java:93-99`

```java
/**
 * Logs out the current user.
 * Clears the currentUser session variable and logs the logout action.
 */
public void logout() {
    if (currentUser != null) {
        System.out.println("âœ“ " + currentUser.getUsername() + " logged out successfully.");
        logAction(currentUser.getUsername(), currentUser.getUserRole(), "LOGOUT", "User logged out");
        currentUser = null;  // Clear session
    }
    // If already logged out (currentUser == null), do nothing
}
```

---

### 5. Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LOGOUT FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User selects option 0 (Logout)
    â”‚
    â”œâ”€â”€â†’ Check: currentUser != null?
    â”‚         â”œâ”€â”€â†’ YES: Continue
    â”‚         â””â”€â”€â†’ NO: Do nothing (already logged out)
    â”‚
    â”œâ”€â”€â†’ Get username from currentUser
    â”‚
    â”œâ”€â”€â†’ Print logout message
    â”‚         â””â”€â”€â†’ "âœ“ [username] logged out successfully."
    â”‚
    â”œâ”€â”€â†’ Log to Audit Trail
    â”‚         â””â”€â”€â†’ auditTrail.push(new AuditLog("LOGOUT", ...))
    â”‚
    â”œâ”€â”€â†’ Clear Session
    â”‚         â””â”€â”€â†’ currentUser = null
    â”‚
    â””â”€â”€â†’ Return to Login Screen
```

---

### 6. Example Usage

#### Scenario 1: Admin Logout

**Console Input/Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ BANKING MANAGEMENT SYSTEM          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[0] Logout

âœ“ admin logged out successfully.

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   BANKING SYSTEM - LOGIN REQUIRED   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â†’ Username:
```

**Audit Trail:**
```
AuditLog {
    timestamp: 2025-12-04T16:50:00,
    username: "admin",
    role: ADMIN,
    action: "LOGOUT",
    details: "User logged out"
}
```

---

#### Scenario 2: Customer Logout

**Console Input/Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ TRANSACTION MENU (ATM Mode)       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[0] Logout

âœ“ alice logged out successfully.

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   BANKING SYSTEM - LOGIN REQUIRED   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â†’ Username:
```

---

## Shared Option: Exit Application

### 1. Menu Option Details

| Property | Value |
|----------|-------|
| **Admin Menu Number** | 20 |
| **Customer Menu Number** | 7 |
| **Menu Label** | "Exit Application" |
| **MenuAction Enum** | `EXIT` |
| **Handler Method** | `Main.java` (loop termination) |
| **Source File** | `src/com/banking/Main.java` |
| **Access Restrictions** | Both Admin and Customer |
| **OOP Concept** | **Graceful Shutdown** (cleanup before exit) |

---

### 2. Purpose and Functionality

**What it does:**
- Exits the banking application
- Optionally logs out current user before exit
- Displays goodbye message
- Terminates JVM

**Why it exists:**
- User-friendly: Clear way to close application
- Security: Prompts for logout before exit
- Clean shutdown: Allows cleanup operations
- Prevents accidental closure (menu selection required)

**Business Rules:**
- Available to both Admin and Customer
- No confirmation required (menu selection is confirmation)
- Current session may persist until exit (depending on implementation)

---

### 3. Step-by-Step Code Flow

#### Step 1-2: Selection & Permission
User selects option **20** (Admin) or **7** (Customer).

#### Step 3-7: Business Logic (Graceful Exit)
**Location:** `Main.java` (menu loop termination)

```java
// In Main.java menu loop
if (action == MenuAction.EXIT) {
    // Optional: Logout current user before exit
    if (bankingSystem.getCurrentUser() != null) {
        System.out.println("âš  You are still logged in. Logging out...");
        bankingSystem.getAuthenticationManager().logout();
    }

    // Display goodbye message
    System.out.println("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    System.out.println("â•‘  Thank you for using our system!   â•‘");
    System.out.println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

    // Exit JVM
    System.exit(0);  // Clean shutdown
}
```

---

### 4. Code Snippets

#### MenuAction Enum (Exit)

**File:** `MenuAction.java`

```java
// Admin Menu
EXIT(20, -1, "Exit Application", UserRole.ADMIN, false),

// Customer Menu
EXIT_CUSTOMER(-1, 7, "Exit Application", UserRole.CUSTOMER, false),
```

**Note:** `EXIT` action terminates application loop, triggering shutdown sequence.

---

### 5. Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXIT APPLICATION FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User selects option 20 (Admin) or 7 (Customer)
    â”‚
    â”œâ”€â”€â†’ Check: currentUser != null?
    â”‚         â”œâ”€â”€â†’ YES: Logout current user
    â”‚         â”‚       â””â”€â”€â†’ authManager.logout()
    â”‚         â””â”€â”€â†’ NO: Skip logout
    â”‚
    â”œâ”€â”€â†’ Display goodbye message
    â”‚         â””â”€â”€â†’ "Thank you for using our system!"
    â”‚
    â”œâ”€â”€â†’ Exit JVM
    â”‚         â””â”€â”€â†’ System.exit(0)
    â”‚
    â””â”€â”€â†’ Application terminates
```

---

### 6. Example Usage

#### Scenario 1: Admin Exits Application

**Console Input/Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ BANKING MANAGEMENT SYSTEM          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[20] Exit Application

âš  You are still logged in. Logging out...
âœ“ admin logged out successfully.

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Thank you for using our system!   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[Application terminates]
```

---

#### Scenario 2: Customer Exits After Logout

**Console Input/Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ TRANSACTION MENU (ATM Mode)       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[0] Logout

âœ“ alice logged out successfully.

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   BANKING SYSTEM - LOGIN REQUIRED   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[User realizes they're done and wants to exit]
[Types Ctrl+C or closes terminal]
```

**Note:** After logout, user is at login screen. Exit option is only available within menus (Admin #20, Customer #7), not at login screen.

---

## Summary Table: Security & Session Operations

| Operation | Admin # | Customer # | Access | OOP Concept | Data Structure |
|-----------|---------|------------|--------|-------------|----------------|
| **Change Password** | 21 | 6 | Both | Immutable User Pattern | LinkedList<User> replacement |
| **Logout** | 0 | 0 | Both | Session Management | currentUser nullification |
| **Exit Application** | 20 | 7 | Both | Graceful Shutdown | JVM termination |

---

## Related Documentation

- **[6-Menu-Overview.md](6-Menu-Overview.md)** - Complete menu architecture
- **[6.1-Login.md](6.1-Login.md)** - Login authentication flow
- **[5-Security-Features.md](5-Security-Features.md)** - Security architecture, RBAC, audit logging
- **[1-OOP-Analysis.md](1-OOP-Analysis.md)** - Immutable User pattern analysis

---

## Key Takeaways

### Immutable User Pattern (Change Password)
```java
// OLD USER (discarded):
User oldUser = new Admin("admin", "oldPass");

// NEW USER (created and replaced):
User newUser = new Admin("admin", "newPass");
userRegistry.set(index, newUser);  // Replace in LinkedList
currentUser = newUser;              // Update session
```

**Benefits:**
- Thread-safe (no concurrent modification)
- Audit-friendly (old object traceable until GC)
- Atomic password changes (all-or-nothing)

### Session Management (Logout)
```java
// LOGGED IN:
currentUser = Admin("admin", "admin123", UserRole.ADMIN)

// LOGGED OUT:
currentUser = null  â† Session cleared
```

**Security:** All operations check `currentUser != null` before proceeding.

### Graceful Shutdown (Exit)
```java
// Exit with logout:
authManager.logout();           // Clear session
System.out.println("Goodbye!");
System.exit(0);                 // Terminate JVM
```

---

**â† Back to:** [Profile Operations & Reports](6.5-Profile-Reports.md) | **â†‘ Up to:** [Menu Overview](6-Menu-Overview.md)
